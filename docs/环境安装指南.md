# Model Zoo环境安装指南
## 目录
- [Model Zoo环境安装指南](#Model Zoo环境安装指南)
  - [目录](#目录)
  - [1 taNNTC环境搭建](#1-taNNTC环境搭建)
  - [2 开发和运行环境搭建](#2-开发和运行环境搭建)
    - [2.1 交叉编译环境搭建](#21-交叉编译环境搭建)

Model Zoo所依赖的环境主要包括用于编译和量化模型的taNNTC，用于编译C++程序的开发环境以及用于部署程序的运行环境。

## 1 taNNTC环境搭建
使用taNNTC编译nb，通常需要在x86主机上安装taNNTC环境，x86主机已安装18.04/20.04/22.04系统，并且运行内存在16GB以上。taNNTC环境安装步骤主要包括：

1. 安装Docker
   若已安装docker，请跳过本节。
    ```bash
    # 如果您的docker环境损坏，可以先卸载docker
    sudo apt-get remove docker docker.io containerd runc

    # 安装依赖
    sudo apt-get update
    sudo apt-get install \
            ca-certificates \
            curl \
            gnupg \
            lsb-release

    # 获取密钥
    sudo mkdir -p /etc/apt/keyrings
    curl -fsSL \
        https://download.docker.com/linux/ubuntu/gpg | \
        gpg --dearmor -o docker.gpg && \
        sudo mv -f docker.gpg /etc/apt/keyrings/

    # 添加 docker 软件包
    echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
        https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | \
        sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

    # 安装 docker
    sudo apt-get update
    sudo apt-get install docker-ce docker-ce-cli containerd.io docker-compose-plugin
    
    # docker命令免root权限执行
    # 创建docker用户组，若已有docker组会报错，没关系可忽略
    sudo groupadd docker
    # 将当前用户加入docker组
    sudo usermod -aG docker $USER
    # 切换当前会话到新group或重新登录重启X会话
    newgrp docker​ 
    ```
    > **提示**：需要logout系统然后重新登录，再使用docker就不需要sudo了。

2. 创建并进入docker

    taNNTC所使用的docker镜像为mes20/ta-nntc:latest，该镜像与taNNTC版本是一一对应的。如果taNNTC有更新，需要同步更新docker镜像。
    ```bash
    docker pull harbor.topsfuture.com:9099/mes20/ta-nntc:latest
    # 这里将本级目录映射到docker内的/workspace目录,用户需要根据实际情况将demo的目录映射到docker里面
    # myname只是举个名字的例子, 请指定成自己想要的容器的名字
    docker run --privileged --name myname --network host -v $PWD:/myworkspace -it harbor.topsfuture.com:9099/mes20/ta-nntc:latest
    # 此时已经进入docker，并在/workspace目录下  
    ```

3. taNNTC使用
taNNTC已经安装好，直接使用即可。可有参照sample中提供的模型转换脚本进行模型转换。


## 2 开发与运行环境搭建

针对EA65XX平台，SDK安装完成后，已经内置了taruntime、ta-opencv等所需运行库，可直接用于部署运行环境。通常，需在x86主机上进行交叉编译，以生成可在SoC平台运行的程序。

### 2.1 交叉编译环境搭建

在x86主机上，需使用TACO SDK进行交叉编译环境的搭建。推荐通过Docker构建交叉编译环境，具体操作如下：

1. 获取TACO SDK  
访问下列链接，下载TACO SDK：https://bj25486.apps.aliyunfile.com/disk/s/pbMmCkFMKJC?domainId=bj25486

2. 将sample代码拷贝到TACO SDK目录下

3. 启动Docker编译环境  
进入解压后的目录，并执行脚本以启动并进入已预配置好的Docker容器：
```bash
./start_workshop_docker.sh
```
此时即可在容器内进行程序编译。